<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVIST - Master Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --sidebar-bg: #0f172a; --accent: #3b82f6; --bg-main: #f8fafc; --card: #ffffff; --border: #e2e8f0; --text-dark: #1e293b; --text-muted: #64748b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-main); margin: 0; display: flex; height: 100vh; color: var(--text-dark); }
        .sidebar { width: 280px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: 700; color: var(--accent); border-bottom: 1px solid #1e293b; text-align: center; }
        .nav-group { padding: 20px 0; overflow-y: auto; flex-grow: 1; }
        .nav-label { font-size: 11px; color: #475569; text-transform: uppercase; padding: 15px 25px 5px; font-weight: 700; letter-spacing: 1px; }
        .nav-item { padding: 12px 25px; display: flex; align-items: center; gap: 15px; cursor: pointer; color: #94a3b8; transition: 0.2s; border-left: 4px solid transparent; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: #1e293b; color: white; border-left-color: var(--accent); }
        .main { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .card { background: var(--card); border-radius: 16px; padding: 35px; display: none; border: 1px solid var(--border); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .card.active { display: block; animation: fadeInUp 0.4s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .upload-box { background: #f1f5f9; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #cbd5e1; }
        input, select, textarea { width: 100%; padding: 12px; border: 1.5px solid var(--border); border-radius: 10px; box-sizing: border-box; margin-bottom: 10px; font-family: inherit; }
        .btn { padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; transition: 0.3s; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-success { background: #22c55e; color: white; }
        .btn-delete { background: #fee2e2; color: #ef4444; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .q-box { background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #e2e8f0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; padding: 12px; background: #f1f5f9; color: var(--text-muted); font-size: 12px; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 14px; }
        .ss-link { color: var(--accent); text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">SVIST ADMIN</div>
        <div class="nav-group">
            <div class="nav-label">Management</div>
            <div class="nav-item active" onclick="showTab('vTab', this)"><i class="fa-solid fa-play-circle"></i> Video Lectures</div>
            <div class="nav-item" onclick="showTab('nTab', this)"><i class="fa-solid fa-file-pdf"></i> Study Notes</div>
            <div class="nav-item" onclick="showTab('dqTab', this)"><i class="fa-solid fa-stopwatch"></i> Daily Quiz</div>
            <div class="nav-item" onclick="showTab('tTab', this)"><i class="fa-solid fa-file-pen"></i> Test Builder</div>
            <div class="nav-label">Students & Sales</div>
            <div class="nav-item" onclick="showTab('rTab', this)"><i class="fa-solid fa-chart-line"></i> Exam Results</div>
            <div class="nav-item" onclick="showTab('payTab', this)"><i class="fa-solid fa-money-bill-wave"></i> Payment Approvals</div>
            <div class="nav-item" onclick="showTab('bTab', this)"><i class="fa-solid fa-book"></i> Book Store</div>
            <div class="nav-item" onclick="showTab('pTab', this)"><i class="fa-solid fa-crown"></i> Paid Classes</div>
            <div class="nav-item" onclick="showTab('settingTab', this)" style="color: #fbbf24;"><i class="fa-solid fa-gear"></i> App Settings</div>
        </div>
    </div>

    <div class="main">
        <div id="vTab" class="card active">
            <h2>Free Video Lectures</h2>
            <div class="upload-box">
                <select id="vSub"><option>HINDI</option><option>MATH</option><option>SCIENCE</option></select>
                <input type="text" id="vTitle" placeholder="Video Title">
                <input type="text" id="vLink" placeholder="YouTube URL">
                <button class="btn btn-primary" onclick="saveVideo()">Publish Free Video</button>
            </div>
            <table><thead><tr><th>Sub</th><th>Title</th><th>Action</th></tr></thead><tbody id="vAdminList"></tbody></table>
        </div>

        <div id="nTab" class="card">
            <h2>Study Notes</h2>
            <div class="upload-box">
                <input type="text" id="nTitle" placeholder="Note Title">
                <input type="text" id="nLink" placeholder="PDF/Drive Link">
                <button class="btn btn-primary" onclick="addGeneral('portalNotes', {title: nTitle.value, link: nLink.value})">Upload Note</button>
            </div>
            <table><thead><tr><th>Title</th><th>Action</th></tr></thead><tbody id="nAdminList"></tbody></table>
        </div>

        <div id="dqTab" class="card">
            <h2>Daily Quiz Builder</h2>
            <div class="upload-box">
                <input type="text" id="dqTitle" placeholder="Today's Quiz Title">
                <input type="text" id="dqSubName" placeholder="Main Subject (e.g. Mixed)" value="Mixed Subjects">
                <div id="dqArea"></div>
                <button class="btn" style="background:#fff; border:1px dashed #ccc; margin-top:10px;" onclick="addQ('dqArea', true)">+ Add Question with Subject</button>
                <button class="btn btn-primary" style="background:#f59e0b; margin-top:15px;" onclick="saveQuiz('dqArea', 'dqTitle', 'dqSubName', 'dailyQuizzes')">Publish Daily Quiz</button>
            </div>
            <table><thead><tr><th>Quiz Title</th><th>Subject</th><th>Action</th></tr></thead><tbody id="dqAdminList"></tbody></table>
        </div>

        <div id="tTab" class="card">
            <h2>Weekly Test Builder</h2>
            <div class="upload-box">
                <input type="text" id="tTitle" placeholder="Mock Test Name">
                <input type="text" id="tSubName" placeholder="Subject Name">
                <div id="tArea"></div>
                <button class="btn" onclick="addQ('tArea', false)">+ Add Question</button>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="saveQuiz('tArea', 'tTitle', 'tSubName', 'portalTests')">Save Full Test</button>
            </div>
            <table><thead><tr><th>Test Name</th><th>Subject</th><th>Action</th></tr></thead><tbody id="tAdminList"></tbody></table>
        </div>

        <div id="bTab" class="card">
            <h2>Book Store</h2>
            <div class="upload-box">
                <input type="text" id="bkTitle" placeholder="Book Name">
                <textarea id="bkDesc" placeholder="Book Description..."></textarea>
                <input type="text" id="bkImg" placeholder="Book Image URL">
                <input type="text" id="bkLink" placeholder="Buy Link (Amazon/Flipkart)">
                <button class="btn btn-primary" onclick="addGeneral('bookStore', {name: bkTitle.value, desc: bkDesc.value, img: bkImg.value, link: bkLink.value})">Add Book to Store</button>
            </div>
            <table><thead><tr><th>Book Name</th><th>Action</th></tr></thead><tbody id="bkAdminList"></tbody></table>
        </div>

        <div id="pTab" class="card">
            <h2><i class="fa-solid fa-crown"></i> Paid Classes Management</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="upload-box">
                    <h3 style="margin-top:0">1. Create New Batch</h3>
                    <input type="text" id="pBatchName" placeholder="Batch Name">
                    <input type="text" id="pFees" placeholder="Fees">
                    <input type="text" id="pCover" placeholder="Batch Cover Image URL">
                    <button class="btn btn-primary" onclick="createNewBatch()">Create Batch</button>
                </div>
                <div class="upload-box" style="background:#eef2ff;">
                    <h3 style="margin-top:0">2. Upload Video to Batch</h3>
                    <select id="paidBatchSelect"></select>
                    <select id="paidVideoSub">
                        <option value="HINDI">HINDI</option><option value="MATH">MATH</option>
                        <option value="REASONING">REASONING</option><option value="GK">GK</option>
                    </select>
                    <input type="text" id="paidVideoTitle" placeholder="Video Title">
                    <input type="text" id="paidVideoLink" placeholder="YouTube URL">
                    <button class="btn btn-success" onclick="uploadVideoToBatch()">Upload</button>
                </div>
            </div>
            <table><thead><tr><th>Batch Name</th><th>Fees</th><th>Videos</th><th>Action</th></tr></thead><tbody id="batchAdminList"></tbody></table>
        </div>

        <div id="payTab" class="card">
            <h2>Payment Approvals</h2>
            <table><thead><tr><th>User Info</th><th>Batch Requested</th><th>Screenshot</th><th>Action</th></tr></thead><tbody id="payRequestList"></tbody></table>
        </div>

        <div id="settingTab" class="card">
            <h2>App Settings (Scanner & UPI)</h2>
            <div class="upload-box">
                <p>Yahan scanner ka link dalo, ye student ke payment page par dikhega.</p>
                <input type="text" id="setQR" placeholder="Scanner Image URL (e.g. https://...)">
                <input type="text" id="setUPI" placeholder="UPI ID (e.g. svist@ybl)">
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>

        <div id="rTab" class="card"><h2>Exam Results</h2><table><thead><tr><th>Subject</th><th>Test Name</th><th>Score</th><th>Date</th></tr></thead><tbody id="resBody"></tbody></table></div>
    </div>

    <script>
        function showTab(id, el) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            renderAll();
        }

        function saveSettings() {
            const qr = document.getElementById('setQR').value;
            const upi = document.getElementById('setUPI').value;
            localStorage.setItem('svist_app_settings', JSON.stringify({qr, upi}));
            alert("Settings Saved!");
        }

        // --- FIXED FUNCTION: Syntax Errors corrected ---
        function approvePayment(index) {
            let reqs = JSON.parse(localStorage.getItem('paymentRequests')) || [];
            let req = reqs[index];
            if(!req) return;

            // Template literal correctly fixed
            let userKey = `unlocked_${req.userId}`; 
            let unlocked = JSON.parse(localStorage.getItem(userKey)) || [];
            
            if(!unlocked.includes(req.batchName)) unlocked.push(req.batchName);
            localStorage.setItem(userKey, JSON.stringify(unlocked));
            
            // List se request hatana
            reqs.splice(index, 1);
            localStorage.setItem('paymentRequests', JSON.stringify(reqs));
            
            renderAll(); 
            alert(`Batch "${req.batchName}" unlocked for ID: ${req.userId}`);
        }

        function addQ(area, isMixed) {
            const div = document.createElement('div'); div.className = 'q-box';
            let subInp = isMixed ? `<input type="text" class="qSub" placeholder="Subject" style="border-color:#f59e0b">` : '';
            div.innerHTML = `${subInp}<input type="text" class="qT" placeholder="Question Text"><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:5px;"><input type="text" class="op" placeholder="Option A"><input type="text" class="op" placeholder="Option B"><input type="text" class="op" placeholder="Option C"><input type="text" class="op" placeholder="Option D"></div><select class="ans"><option value="0">A</option><option value="1">B</option><option value="2">C</option><option value="3">D</option></select><button class="btn-delete" style="margin-top:10px" onclick="this.parentElement.remove()">Remove</button>`;
            document.getElementById(area).appendChild(div);
        }

        function createNewBatch() {
            const name = document.getElementById('pBatchName').value.trim();
            const fees = document.getElementById('pFees').value;
            const img = document.getElementById('pCover').value;
            if(!name || !fees) return alert("Fill Name and Fees!");
            let batches = JSON.parse(localStorage.getItem('batchAdminList')) || [];
            batches.push({ name, fees, img, videos: [] });
            localStorage.setItem('batchAdminList', JSON.stringify(batches));
            document.getElementById('pBatchName').value = ""; document.getElementById('pFees').value = "";
            renderAll(); alert("Batch Created!");
        }

        function uploadVideoToBatch() {
            const batchName = document.getElementById('paidBatchSelect').value;
            const subject = document.getElementById('paidVideoSub').value;
            const title = document.getElementById('paidVideoTitle').value;
            const url = document.getElementById('paidVideoLink').value;
            if(!batchName || !title || !url) return alert("Fill all fields!");
            let batches = JSON.parse(localStorage.getItem('batchAdminList')) || [];
            let idx = batches.findIndex(b => b.name === batchName);
            if(idx !== -1) {
                batches[idx].videos.push({ subject, title, url });
                localStorage.setItem('batchAdminList', JSON.stringify(batches));
                alert("Video Uploaded!"); renderAll();
            }
        }

        function saveQuiz(area, titleId, subId, storageKey) {
            let qs = [];
            document.getElementById(area).querySelectorAll('.q-box').forEach(b => {
                qs.push({ subject: b.querySelector('.qSub')?.value || "", q: b.querySelector('.qT').value, options: Array.from(b.querySelectorAll('.op')).map(i => i.value), correct: b.querySelector('.ans').value });
            });
            let data = JSON.parse(localStorage.getItem(storageKey)) || [];
            data.push({ title: document.getElementById(titleId).value, subject: document.getElementById(subId).value, questions: qs });
            localStorage.setItem(storageKey, JSON.stringify(data));
            document.getElementById(area).innerHTML = ""; renderAll(); alert("Saved!");
        }

        function addGeneral(key, obj) {
            let data = JSON.parse(localStorage.getItem(key)) || [];
            data.push(obj); localStorage.setItem(key, JSON.stringify(data));
            renderAll(); alert("Success!");
        }

        function saveVideo() {
            let v = JSON.parse(localStorage.getItem('portalVideos')) || [];
            v.push({ subject: document.getElementById('vSub').value, title: document.getElementById('vTitle').value, url: document.getElementById('vLink').value });
            localStorage.setItem('portalVideos', JSON.stringify(v)); renderAll(); alert("Video Published!");
        }

        function del(key, i) {
            if(confirm("Delete?")) {
                let d = JSON.parse(localStorage.getItem(key));
                d.splice(i, 1); localStorage.setItem(key, JSON.stringify(d));
                renderAll();
            }
        }

        function renderAll() {
            const draw = (id, key, fn) => {
                const data = JSON.parse(localStorage.getItem(key)) || [];
                const el = document.getElementById(id); if(el) el.innerHTML = data.map((item, i) => fn(item, i)).join('');
            };

            const set = JSON.parse(localStorage.getItem('svist_app_settings')) || {qr:'', upi:''};
            if(document.getElementById('setQR')) document.getElementById('setQR').value = set.qr;
            if(document.getElementById('setUPI')) document.getElementById('setUPI').value = set.upi;

            const batches = JSON.parse(localStorage.getItem('batchAdminList')) || [];
            document.getElementById('paidBatchSelect').innerHTML = '<option value="">-- Select --</option>' + batches.map(b => `<option value="${b.name}">${b.name}</option>`).join('');

            draw('vAdminList', 'portalVideos', (v, i) => `<tr><td>${v.subject}</td><td>${v.title}</td><td><button class="btn-delete" onclick="del('portalVideos',${i})">Del</button></td></tr>`);
            draw('dqAdminList', 'dailyQuizzes', (q, i) => `<tr><td>${q.title}</td><td>${q.subject}</td><td><button class="btn-delete" onclick="del('dailyQuizzes',${i})">Del</button></td></tr>`);
            draw('tAdminList', 'portalTests', (t, i) => `<tr><td>${t.title}</td><td>${t.subject}</td><td><button class="btn-delete" onclick="del('portalTests',${i})">Del</button></td></tr>`);
            draw('nAdminList', 'portalNotes', (n, i) => `<tr><td>${n.title}</td><td><button class="btn-delete" onclick="del('portalNotes',${i})">Del</button></td></tr>`);
            draw('bkAdminList', 'bookStore', (b, i) => `<tr><td>${b.name}</td><td><button class="btn-delete" onclick="del('bookStore',${i})">Del</button></td></tr>`);
            document.getElementById('batchAdminList').innerHTML = batches.map((b, i) => `<tr><td><b>${b.name}</b></td><td>â‚¹${b.fees}</td><td>${b.videos.length} Videos</td><td><button class="btn-delete" onclick="del('batchAdminList',${i})">Del</button></td></tr>`).join('');

            const payReqs = JSON.parse(localStorage.getItem('paymentRequests')) || [];
            document.getElementById('payRequestList').innerHTML = payReqs.map((r, i) => `<tr><td>${r.userName} (ID: ${r.userId})</td><td>${r.batchName}</td><td><a href="${r.screenshot}" target="_blank" class="ss-link">View Photo</a></td><td><button class="btn btn-success" style="padding:5px;font-size:11px;width:70px" onclick="approvePayment(${i})">Accept</button> <button class="btn-delete" onclick="del('paymentRequests',${i})">Decline</button></td></tr>`).join('');
        }
        window.onload = renderAll;
    </script>
</body>
</html>